<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= typeof title !== 'undefined' ? title : 'Reset Password | PawPalace' %></title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Quicksand', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#fff1f2', 100: '#ffe4e6', 200: '#fecdd3', 300: '#fda4af',
                            400: '#fb7185', 500: '#f43f5e', 600: '#e11d48', 700: '#be123c',
                            800: '#9f1239', 900: '#881337',
                        },
                        accent: {
                            teal: '#2dd4bf', tealDark: '#0d9488', navy: '#0f172a', cream: '#fffdf5'
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="font-sans text-accent-navy antialiased bg-accent-cream selection:bg-accent-teal selection:text-white min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden">

    <div class="absolute top-[-10%] left-[-5%] w-[35rem] h-[35rem] bg-brand-200 rounded-full mix-blend-multiply filter blur-3xl opacity-60 animate-float pointer-events-none"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[35rem] h-[35rem] bg-accent-teal/30 rounded-full mix-blend-multiply filter blur-3xl opacity-80 animate-float pointer-events-none" style="animation-delay: 2s;"></div>

    <div class="bg-white rounded-[2.5rem] shadow-2xl p-8 md:p-12 w-full max-w-md relative z-10 border-4 border-white/50 backdrop-blur-sm">
        
        <a href="/login" class="absolute top-8 left-8 text-gray-400 hover:text-accent-navy transition flex items-center gap-2 font-bold text-sm">
            <i class="fa-solid fa-arrow-left"></i> Back
        </a>

        <div class="text-center mt-8">
            <div class="w-20 h-20 bg-accent-teal/10 rounded-full flex items-center justify-center mx-auto mb-6 text-accent-tealDark text-3xl shadow-sm">
                <i class="fa-solid fa-key"></i>
            </div>

            <h1 class="text-3xl font-extrabold text-accent-navy mb-3">Forgot Password?</h1>
            <p class="text-gray-500 font-medium mb-8 leading-relaxed">
                Don't worry, it happens to the best of us! Enter your email and we'll fetch a recovery code.
            </p>
        </div>

        <% if (typeof error !== 'undefined' && error) { %>
            <div class="mb-6 p-4 bg-red-50 border-2 border-red-100 rounded-xl flex items-center gap-3 text-red-600 font-bold text-sm">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span><%= error %></span>
            </div>
        <% } %>

        <form action="/forgot-password" method="POST" class="space-y-6" id="recoveryForm">
            
            <div>
                <label for="email" class="block text-sm font-bold text-accent-navy mb-2 ml-1">Email Address</label>
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <i class="fa-regular fa-envelope text-gray-400 group-focus-within:text-accent-tealDark transition"></i>
                    </div>
                    <input type="email" name="email" id="email" value="<%= typeof email !== 'undefined' ? email : '' %>" class="w-full pl-11 pr-4 py-4 bg-gray-50 border-2 border-gray-100 rounded-xl focus:outline-none focus:bg-white focus:border-brand-500 text-accent-navy font-bold transition duration-200 placeholder-gray-400" placeholder="doggo@example.com" required>
                    <p id="emailError" class="text-sm text-red-500 mt-2 hidden ml-1"></p>
                </div>
            </div>

            <button type="submit" id="submitBtn" disabled class="w-full bg-brand-500 text-white py-4 rounded-xl font-bold text-lg shadow-[4px_4px_0px_0px_rgba(13,148,136,1)] hover:shadow-none hover:translate-x-[2px] hover:translate-y-[2px] transition-all flex items-center justify-center gap-2 group">
                <span id="btnText">Send Recovery Code</span> 
                <i id="btnIcon" class="fa-solid fa-paper-plane group-hover:translate-x-1 group-hover:-translate-y-1 transition"></i>
            </button>

        </form>

    </div>

    <p class="mt-8 text-gray-400 font-bold text-sm relative z-10 text-center">
        Remember your password? <a href="/login" class="text-accent-tealDark hover:underline">Log in</a>
    </p>

    <!-- <script>
        const form = document.getElementById('recoveryForm');
        const btn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const btnIcon = document.getElementById('btnIcon');

        form.onsubmit = function() {
            // Visual feedback on submit
            btnText.innerText = 'Sending...';
            btnIcon.className = 'fa-solid fa-circle-notch fa-spin';
            btn.classList.add('opacity-75', 'cursor-not-allowed');
            return true; // Proceed with form POST
        };
    </script> -->

    <script>
    const form = document.getElementById('recoveryForm');
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('emailError');
    const btn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnIcon = document.getElementById('btnIcon');

    function showError(msg) {
        emailError.textContent = msg;
        emailError.classList.remove('hidden');
    }

    function hideError() {
        emailError.textContent = '';
        emailError.classList.add('hidden');
    }

    function validateEmail() {
        const email = emailInput.value.trim();
        const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!regex.test(email)) {
            showError('Please enter a valid email address');
            btn.disabled = true;
            btn.classList.add('cursor-not-allowed', 'bg-brand-500/70');
            btn.classList.remove('bg-brand-500');
            return false;
        }

        hideError();
        btn.disabled = false;
        btn.classList.remove('cursor-not-allowed', 'bg-brand-500/70');
        btn.classList.add('bg-brand-500');
        return true;
    }

    emailInput.addEventListener('input', validateEmail);

    form.onsubmit = function () {
        if (!validateEmail()) return false;

        // visual feedback
        btnText.innerText = 'Sending...';
        btnIcon.className = 'fa-solid fa-circle-notch fa-spin';
        btn.classList.add('opacity-75', 'cursor-not-allowed');
        btn.disabled = true;

        return true;
    };
</script>

</body>
</html>